Array.prototype.indexOf||(Array.prototype.indexOf=function(t){"use strict";if(null===this)throw new TypeError;var e=Object(this),r=e.length>>>0;if(0===r)return-1;var i=0;if(arguments.length>0&&(i=Number(arguments[1]),i!==i?i=0:0!==i&&1/0!==i&&i!==-1/0&&(i=(i>0||-1)*Math.floor(Math.abs(i)))),i>=r)return-1;for(var n=i>=0?i:Math.max(r-Math.abs(i),0);r>n;n++)if(n in e&&e[n]===t)return n;return-1}),function(t){"use strict";var e=function(t,r,i){var n,o,a,s=/^([a-zA-Z]+)(\.[a-zA-Z]*)*$/;if(null===t.match(s)||"window"===t)throw Error("namespace: "+t+" is a malformed namespace string");if(void 0!==r&&void 0===i)if("function"==typeof r)i=r,r=void 0;else{if("object"==typeof r)throw Error("namespace: if second argument exists, final function argument must exist");if("object"!=typeof r)throw Error("namespace: second argument must be an object of aliased local namespaces")}else if("object"!=typeof r&&"function"==typeof i)throw Error("namespace: second argument must be an object of aliased local namespaces");if(n=t.split("."),o="window"===n[0]?window:void 0===window[n[0]]?window[n[0]]={}:window[n[0]],void 0!==i&&"function"!=typeof i)throw Error("namespace: last parameter must be a function that accepts a namespace parameter");for(a=1;n.length>a;a+=1)void 0===o[n[a]]&&(o[n[a]]={}),o=o[n[a]];if(void 0===r&&i)i(o);else if(i){for(a in r)r.hasOwnProperty(a)&&(r[a]=e(r[a]));i.call(r,o)}return o};return e(t,function(t){t.namespace=e})}("window.jermaine.util"),window.jermaine.util.namespace("window.jermaine.util",function(t){"use strict";var e=function(){var t=this,e={};return this.on=function(r,i){if("string"!=typeof r)throw Error("EventEmitter: first argument to 'on' should be a string");if("function"!=typeof i)throw Error("EventEmitter: second argument to 'on' should be a function");return e[r]||(e[r]=[]),e[r].push(i),t},this.addListener=this.on,this.once=function(e,r){var i=function(){r(arguments),t.removeListener(e,i)};return t.on(e,i),t},this.removeListener=function(r,i){var n;if("string"!=typeof r)throw Error("EventEmitter: first parameter to removeListener method must be a string representing an event");if("function"!=typeof i)throw Error("EventEmitter: second parameter must be a function to remove as an event listener");if(void 0===e[r]||0===e[r].length)throw Error("EventEmitter: there are no listeners registered for the '"+r+"' event");return n=e[r].indexOf(i),-1!==n&&e[r].splice(n,1),t},this.removeAllListeners=function(r){if("string"!=typeof r)throw Error("EventEmitter: parameter to removeAllListeners should be a string representing an event");return void 0!==e[r]&&(e[r]=[]),t},this.setMaxListeners=function(){return t},this.listeners=function(t){if("string"!=typeof t)throw Error("EventEmitter: listeners method must be called with the name of an event");return void 0===e[t]?[]:e[t]},this.emit=function(t){var r,i;for(arguments.length>1&&(i=[]),r=1;arguments.length>r;++r)i.push(arguments[r]);if(void 0!==e[t])for(r=0;e[t].length>r;r+=1)e[t][r].apply(this,i)},t};t.EventEmitter=e}),window.jermaine.util.namespace("window.jermaine",function(t){"use strict";var e,r={};e=function(t){var e=function(e){var r,i,n={};if(r=t.call(n,e),!r)throw i=n.message||"validator failed with parameter "+e,Error(i);return r};return e},e.addValidator=function(t,i){if(void 0===t||"string"!=typeof t)throw Error("addValidator requires a name to be specified as the first parameter");if(void 0===i||"function"!=typeof i)throw Error("addValidator requires a function as the second parameter");if(void 0!==r[t])throw Error("Validator '"+t+"' already defined");r[t]=function(t){return new e(function(e){var r={actual:e,param:e},n=i.call(r,t);return this.message=r.message,n})}},e.getValidator=function(t){var e;if(void 0===t)throw Error("Validator: getValidator method requires a string parameter");if("string"!=typeof t)throw Error("Validator: parameter to getValidator method must be a string");if(e=r[t],void 0===e)throw Error("Validator: '"+t+"' does not exist");return e},e.validators=function(){var t,e=[];for(t in r)r.hasOwnProperty(t)&&e.push(t);return e},e.addValidator("isGreaterThan",function(t){return this.message=this.param+" should be greater than "+t,this.param>t}),e.addValidator("isLessThan",function(t){return this.message=this.param+" should be less than "+t,t>this.param}),e.addValidator("isA",function(t){var e=["string","number","boolean","function","object"];if("string"==typeof t&&e.indexOf(t)>-1)return this.message=this.param+" should be a "+t,typeof this.param===t;if("integer"===t)return this.message=void 0!==this.param.toString?""+this.param+" should be an integer":"parameter should be an integer","number"==typeof this.param&&parseInt(this.param,10)===this.param;throw"string"==typeof t?Error("Validator: isA accepts a string which is one of "+e):Error("Validator: isA only accepts a string for a primitive types for the time being")}),r.isAn=r.isA,e.addValidator("isOneOf",function(t){return this.message=this.param+" should be one of the set: "+t,t.indexOf(this.param)>-1}),t.Validator=e}),window.jermaine.util.namespace("window.jermaine",function(t){"use strict";var e=function(t){var r,i,n,o,a=[],s=this,u="invalid setter call for "+t,h=!1,f={},d=window.jermaine.AttrList,c=window.jermaine.Validator;if(void 0===t||"string"!=typeof t)throw Error("Attr: constructor requires a name parameter which must be a string");for(o=function(t){for(i=0;a.length>i;++i)a[i](t);return!0},this.validatesWith=function(t){if("function"==typeof t)return a.push(new c(t)),this;throw Error("Attr: validator must be a function")},this.defaultsTo=function(t){return r=t,this},this.isReadOnly=function(){return h=!0,this},this.isWritable=function(){return h=!1,this},this.on=function(t,e){if("set"!==t&&"get"!==t)throw Error("Attr: first argument to the 'on' method should be 'set' or 'get'");if("function"!=typeof e)throw Error("Attr: second argument to the 'on' method should be a function");f[t]=e},this.name=function(){return t},this.validator=function(){return o},this.and=this,this.which=this,this.isImmutable=this.isReadOnly,this.isMutable=this.isWritable,this.clone=function(){var i,n;for(i=this instanceof d?new d(t):new e(t),n=0;a.length>n;++n)i.validatesWith(a[n]);return i.defaultsTo(r),h&&i.isImmutable(),i},this.addTo=function(e){var i,n;if(!e||"object"!=typeof e)throw Error("Attr: addAttr method requires an object parameter");if(e[t]=function(r){var n;if(void 0!==r){if(h&&void 0!==i)throw Error("cannot set the immutable property "+t+" after it has been set");if(!o(r))throw Error(u);return n=i,i=r,void 0!==f.set&&f.set.call(e,r,n),e}return void 0!==f.get&&f.get.call(e,i),i},n="function"==typeof r?r():r,void 0!==n&&o(n))e[t](n);else if(void 0!==n&&!o(n))throw Error("Attr: Default value of "+n+" does not pass validation for "+t)},n=function(t){s[t]=function(e){return a.push(c.getValidator(t)(e)),s}},i=0;c.validators().length>i;++i)n(c.validators()[i])};t.Attr=e}),window.jermaine.util.namespace("window.jermaine",function(t){"use strict";function e(e){var r=this,i={};t.Attr.call(this,e);var n=function(t,e){return function(){return t[e].apply(t,arguments)}};this.validateWith=this.validatesWith,this.defaultsTo=function(){},this.isImmutable=function(){},this.isMutable=function(){},this.eachOfWhich=this,this.on=function(t,e){if("add"!==t)throw Error("AttrList: 'on' only responds to 'add' event");if("function"!=typeof e)throw Error("AttrList: 'on' requires a listener function as the second parameter");i[t]=e},this.addTo=function(t){var o=[],a={};if(!t||"object"!=typeof t)throw Error("AttrList: addTo method requires an object parameter");a.pop=n(o,"pop"),a.add=function(e){if(r.validator()(e))return o.push(e),void 0!==i.add&&i.add.call(t,e,a.size()),this;throw Error(r.errorMessage())},a.replace=function(t,e){if("number"!=typeof t||parseInt(t,10)!==t)throw Error("AttrList: replace method requires index parameter to be an integer");if(0>t||t>=this.size())throw Error("AttrList: replace method index parameter out of bounds");if(!r.validator()(e))throw Error(r.errorMessage());return o[t]=e,this},a.at=function(t){if(0>t||t>=this.size())throw Error("AttrList: Index out of bounds");return o[t]},a.get=a.at,a.size=function(){return o.length},a.toJSON=function(t){var e,r=[];if(void 0!==t)for(e=0;t.length>e;++e)t[e].object===this&&(r=t[e].JSONrep);for(e=0;o.length>e;++e)o[e].toJSON?r.push(o[e].toJSON(t)):r.push(o[e]);return r},t[e]=function(){return a}}}e.prototype=new window.jermaine.Attr(name),t.AttrList=e}),window.jermaine.util.namespace("window.jermaine",function(t){"use strict";var e=function(t,e){if(!t||"string"!=typeof t)throw Error("Method: constructor requires a name parameter which must be a string");if(!e||"function"!=typeof e)throw Error("Method: second parameter must be a function");this.addTo=function(r){if(!r||"object"!=typeof r)throw Error("Method: addTo method requires an object parameter");r[t]=e}};t.Method=e}),window.jermaine.util.namespace("window.jermaine",function(t){"use strict";var e=function(r){var i,n,o,a,s,u,h={},f={},d=!0,c=[],l=[],m=[],p=t.Method,g=t.Attr,v=t.AttrList,w=t.util.EventEmitter,b=function(){},y=function(){},E=function(){return d&&(E.validate(),s()),y.apply(this,arguments)};if(1===arguments.length&&"string"==typeof r&&(n=r,r=void 0),arguments.length>1&&(r=arguments[arguments.length-1]),r&&"function"==typeof r)return E=new e,r.call(E),E;if(r)throw Error("Model: specification parameter must be a function");var A=function(t,e){var r,i,n;if(r="Attr"===t?g:v,i="Attr"===t?"hasA":"hasMany",d=!0,"string"==typeof e)return n=new r(e),f[e]=n,n;throw Error("Model: "+i+" parameter must be a string")};return o=function(t,e){var r;if("string"!=typeof e)throw Error("Model: expected string argument to "+t+" method, but recieved "+e);if(r="attribute"===t?f[e]:h[e],void 0===r)throw Error("Model: "+t+" "+e+" does not exist!");return r},a=function(t){var e,r=[],i="attributes"===t?f:h;for(e in i)i.hasOwnProperty(e)&&r.push(e);return r},s=function(){y=function(){var t,e,r,n,o,a,s=E.attributes(),h=E.methods(),d=new w,m={},p=this;if(!(this instanceof E))return arguments.length>0?new E(arguments):new E;for(this.emitter=function(){return d},this.emitter().removeJermaineChangeListener=function(t,e){if("string"!=typeof t)throw Error("attrName must be a string");if("object"!=typeof e||void 0===e.toJSON||void 0===e.emitter)throw Error("obj must be a jermaine object");e.emitter().removeListener("change",m[t])},this.emitter().addJermaineChangeListener=function(e,r){if("string"!=typeof e)throw Error("attrName must be a string");if("object"!=typeof r||void 0===r.toJSON||void 0===r.emitter)throw Error("obj must be a jermaine object");void 0===m[e]&&(m[e]=function(r){var i=[],n=!0;for(t=0;r.length>t&&n===!0;++t)i.push(r[t]),r[t].origin===p&&(n=!1);n&&(i.push({key:e,origin:p}),p.emit("change",i))}),r.emitter().on("change",m[e])},this.on=this.emitter().on,this.emit=this.emitter().emit,this.toJSON=function(t){var e,r,i,n,o={};if(void 0===t)t=[],t.push({object:this,JSONrep:o});else{if("object"!=typeof t)throw Error("Instance: toJSON should not take a parameter (unless called recursively)");for(r=0;t.length>r;++r)t[r].object===this&&(o=t[r].JSONrep)}for(r=0;s.length>r;++r){for(n=null,e=this[s[r]](),i=0;t.length>i;++i)t[i].object===e&&(n=t[i].JSONrep);void 0!==e&&null!==e&&void 0!==e.toJSON&&null===n&&(n=f[s[r]]instanceof v?[]:{},t.push({object:e,JSONrep:n}),t[t.length-1].JSONrep=e.toJSON(t)),o[s[r]]=null===n?e:n}return o},this.toString=void 0!==i?i:function(){return"Jermaine Model Instance"},a=function(t){t instanceof v?t.on("add",function(e){this.emit("change",[{action:"add",key:t.name(),value:e,origin:this}])}):t.on("set",function(e,r){if(void 0!==r&&null!==r&&void 0!==r.on&&void 0!==r.toJSON&&void 0!==r.emitter){if(1>r.emitter().listeners("change").length)throw Error("preValue should always have a listener defined if it is a model");this.emitter().removeJermaineChangeListener(t.name(),r)}void 0!==e&&null!==e&&void 0!==e.on&&void 0!==e.toJSON&&void 0!==e.emitter&&this.emitter().addJermaineChangeListener(t.name(),e),this.emit("change",[{key:t.name(),value:e,origin:this}])})},t=0;s.length>t;++t)o=E.attribute(s[t]),a.call(this,o);for(t=0;s.length+h.length>t;++t)s.length>t?(u&&E.attribute(s[t]).isImmutable(),E.attribute(s[t]).addTo(this)):E.method(h[t-s.length]).addTo(this);if(arguments.length>0){if(arguments.length<c.length){for(r="Constructor requires ",t=0;c.length>t;++t)r+=c[t],r+=t===c.length-1?"":", ";throw r+=" to be specified",Error(r)}if(arguments.length>c.length+l.length)throw Error("Too many arguments to constructor. Expected "+c.length+" required arguments and "+l.length+" optional arguments");for(t=0;arguments.length>t;++t)if(n=c.length>t?c[t]:l[t-c.length],E.attribute(n)instanceof v){if("[object Array]"!==Object.prototype.toString.call(arguments[t]))throw Error("Model: Constructor requires 'names' attribute to be set with an Array");for(e=0;arguments[t].length>e;++e)this[n]().add(arguments[t][e])}else this[n](arguments[t])}b.call(this)}},E.hasA=function(t){return A("Attr",t)},E.hasAn=E.hasA,E.hasSome=E.hasA,E.hasMany=function(t){return A("AttrList",t)},E.isA=function(t){var r,i,n,o;if(d=!0,o=function(t){var r,i=new e;for(r in i)if(i.hasOwnProperty(r)&&typeof t[r]!=typeof i[r])return!1;return!0},"function"!=typeof t||!o(t))throw Error("Model: parameter sent to isA function must be a Model");if(0!==m.length)throw Error("Model: Model only supports single inheritance at this time");for(m.push(t),i=m[0].attributes(),r=0;i.length>r;++r)void 0===f[i[r]]&&(f[i[r]]=m[0].attribute(i[r]).clone(),f[i[r]].isMutable());for(n=m[0].methods(),r=0;n.length>r;++r)void 0===h[n[r]]&&(h[n[r]]=m[0].method(n[r]));for(r=0;m.length>r;r++)E.prototype=new m[r]},E.isAn=E.isA,E.parent=function(){return m[0].apply(this,arguments)},E.attribute=function(t){return o("attribute",t)},E.attributes=function(){return a("attributes")},E.method=function(t){return o("method",t)},E.methods=function(){return a("methods")},E.isBuiltWith=function(){var t,e=!1;for(d=!0,c=[],l=[],t=0;arguments.length>t;++t)if("string"==typeof arguments[t]&&"%"!==arguments[t].charAt(0)){if(e)throw Error("Model: isBuiltWith requires parameters preceded with a % to be the final parameters before the optional function");c.push(arguments[t])}else if("string"==typeof arguments[t]&&"%"===arguments[t].charAt(0))e=!0,l.push(arguments[t].slice(1));else{if("function"!=typeof arguments[t]||t!==arguments.length-1)throw Error("Model: isBuiltWith parameters must be strings except for a function as the optional final parameter");b=arguments[t]}},E.isImmutable=function(){u=!0},E.looksLike=function(t){d=!0,i=t},E.respondsTo=function(t,e){var r=new p(t,e);d=!0,h[t]=r},E.validate=function(){var t,e=this.attributes(),r=this.methods();for(t=0;c.length>t;++t)try{this.attribute(c[t])}catch(i){throw Error(c[t]+", specified in the isBuiltWith method, is not an attribute")}for(t=0;l.length>t;++t)try{this.attribute(l[t])}catch(i){throw Error(l[t]+", specified in the isBuiltWith method, is not an attribute")}for(t=0;e.length>t;t++)if(r.indexOf(e[t])>-1)throw Error("Model: invalid model specification to "+e[t]+" being both an attribute and method");if(u)for(t=0;e.length>t;t++)if(0>c.indexOf(e[t]))throw Error("immutable objects must have all attributes required in a call to isBuiltWith");d=!1},E};t.Model=e});